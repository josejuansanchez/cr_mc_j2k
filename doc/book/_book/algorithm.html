<!DOCTYPE HTML>
<html lang="en-US">
    <head prefix="og: http://ogp.me/ns# book: http://ogp.me/ns/book#">
        
        <meta charset="UTF-8">
        <title>Algoritmo | Conditional Replenishment and Motion Compensation</title>

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="robots" content="index, follow">
        <meta name="author" content="">
        <meta name="description" content="J.J. Sánchez-Hernández, J.P. García-Ortiz, V. González-Ruiz">
        <meta name="keywords" content="gitbook,github" >
        <meta name="generator" content="www.gitbook.io">

        
        <link rel="next" href="./tools.html" />
        
        
        <link rel="prev" href="./index.html" />
        

        <meta property="og:title" content="Algoritmo | Conditional Replenishment and Motion Compensation">
        <meta property="og:site_name" content="Conditional Replenishment and Motion Compensation">
        <meta property="og:type" content="book">
        <meta property="og:locale" content="en_US">

        <meta property="book:author" content="https://github.com/">
        <meta property="book:tag" content="GitBook">

        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">

        <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">
        
    </head>
    <body>
        

        <link rel="stylesheet" href="gitbook/style.css">
        


        
    <div class="book"  data-level="1" data-basepath="." data-revision="1398340400236">
    <div class="book-header">
    <!-- Actions Left -->
    
    <a href="#" class="btn pull-left toggle-summary"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search"><i class="fa fa-search"></i></a>
    <span id="font-settings-wrapper">
        <a href="#" class="btn pull-left toggle-font-settings"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
	<div class="dropdown-caret">
  <span class="caret-outer"></span>
  <span class="caret-inner"></span>
</div>

	<div class="btn-group btn-block">
		<button id="reduce-font-size" class="btn btn-default">A</button>
		<button id="enlarge-font-size" class="btn btn-default">A</button>
	</div>

	<ul class="list-group font-family-list">
		<li class="list-group-item" data-font="0">Serif</li>
		<li class="list-group-item" data-font="1">Sans</li>
	</ul>

	<div class="btn-group btn-group-xs btn-block color-theme-list">
	  <button type="button" class="btn btn-default" id="color-theme-preview-0" data-theme="0">White</button>
	  <button type="button" class="btn btn-default" id="color-theme-preview-1" data-theme="1">Sepia</button>
	  <button type="button" class="btn btn-default" id="color-theme-preview-2" data-theme="2">Night</button>
	</div>
</div>

    </span>

    <!-- Actions Right -->
    <a href="#" target="_blank" class="btn pull-right" data-sharing="google-plus"><i class="fa fa-google-plus"></i></a>
    <a href="#" target="_blank" class="btn pull-right" data-sharing="facebook"><i class="fa fa-facebook"></i></a>
    <a href="#" target="_blank" class="btn pull-right" data-sharing="twitter"><i class="fa fa-twitter"></i></a>

    

    <!-- Title -->
    <h1><a href="./" >Conditional Replenishment and Motion Compensation</a></h1>
</div>

    <div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="Search" class="form-control" />
    </div>
    <ul class="summary">
        
        <li data-level="0" data-path="index.html">
            <a href="./"><i class="fa fa-check"></i> Introduction</a>
        </li>
        
            <li  data-level="1" data-path="algorithm.html">
                
                <a href="./algorithm.html">
                    <i class="fa fa-check"></i> <b>1.</b> Algoritmo
                </a>
                
                
            </li>
        
            <li  data-level="2" data-path="tools.html">
                
                <a href="./tools.html">
                    <i class="fa fa-check"></i> <b>2.</b> Tools
                </a>
                
                
            </li>
        
            <li  data-level="3" data-path="packets.html">
                
                <a href="./packets.html">
                    <i class="fa fa-check"></i> <b>3.</b> JPEG2000 Packet Structure
                </a>
                
                
            </li>
        
            <li  data-level="4" data-path="cacheformat.html">
                
                <a href="./cacheformat.html">
                    <i class="fa fa-check"></i> <b>4.</b> Formato `.cache`
                </a>
                
                
            </li>
        
            <li  data-level="5" data-path="stateoftheart.html">
                
                <a href="./stateoftheart.html">
                    <i class="fa fa-check"></i> <b>5.</b> State of the art
                </a>
                
                
            </li>
        
            <li  data-level="6" data-path="changelog.html">
                
                <a href="./changelog.html">
                    <i class="fa fa-check"></i> <b>6.</b> Changelog
                </a>
                
                
            </li>
        
            <li  data-level="7" data-path="todos.html">
                
                <a href="./todos.html">
                    <i class="fa fa-check"></i> <b>7.</b> TODOs
                </a>
                
                
            </li>
        
            <li  data-level="8" data-path="knapsack.html">
                
                <a href="./knapsack.html">
                    <i class="fa fa-check"></i> <b>8.</b> Knapsack Algorithm
                </a>
                
                
            </li>
        
    </ul>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="page-wrapper" tabindex="-1">
                <div class="book-progress">
    <div class="bar">
        <div class="inner" style="width: 12.5%;min-width: 0%;"></div>
    </div>
    <div class="chapters">
    
        <a href="./index.html" title="Introduction" class="chapter done new-chapter" data-progress="0" style="left: 0%;"></a>
    
        <a href="./algorithm.html" title="Algoritmo" class="chapter done new-chapter" data-progress="1" style="left: 12.5%;"></a>
    
        <a href="./tools.html" title="Tools" class="chapter  new-chapter" data-progress="2" style="left: 25%;"></a>
    
        <a href="./packets.html" title="JPEG2000 Packet Structure" class="chapter  new-chapter" data-progress="3" style="left: 37.5%;"></a>
    
        <a href="./cacheformat.html" title="Formato `.cache`" class="chapter  new-chapter" data-progress="4" style="left: 50%;"></a>
    
        <a href="./stateoftheart.html" title="State of the art" class="chapter  new-chapter" data-progress="5" style="left: 62.5%;"></a>
    
        <a href="./changelog.html" title="Changelog" class="chapter  new-chapter" data-progress="6" style="left: 75%;"></a>
    
        <a href="./todos.html" title="TODOs" class="chapter  new-chapter" data-progress="7" style="left: 87.5%;"></a>
    
        <a href="./knapsack.html" title="Knapsack Algorithm" class="chapter  new-chapter" data-progress="8" style="left: 100%;"></a>
    
    </div>
</div>

                <div class="page-inner">
                
                    <section class="normal" id="section-gitbook_2">
                    
                        <h1 id="algoritmo">Algoritmo</h1>
<ol>
<li><p>Se descargan las dos primeras imágenes de la secuencia, $I<em>i$
 (even_image) y $I</em>{i+1}$ (odd_image). </p>
</li>
<li><p>Calculamos los <strong>vectores de movimiento</strong> entre las dos imágenes, 
$I<em>i$ ($even_image$) y $I</em>{i+1}$ ($odd_image$).<br>Tool: <a href="tools.html#tool_motion_estimation"><code>me</code></a>. </p>
</li>
<li><p>Generamos una <strong>imagen predicción</strong>, $PI<em>{i+2}$, a partir de la imagen $I</em>{i+1}$
($odd_image$) y los vectores de movimiento calculados en el paso
anterior.<br>Tool: <a href="tools.html#decorrelate"><code>decorrelate</code></a>. </p>
</li>
<li><p>A partir de la imagen predicción $PI<em>{i+2}$, obtenemos el <strong>thumbnail</strong> 
$Thumbnail(PI</em>{i+2})$.<br>Tool: <a href="tools.html#tool_mogrify"><code>mogrify</code></a>. </p>
</li>
<li><p>Solicitamos al servidor el thumbnail de la siguiente imagen de la
secuencia, $Thumbnail(I_{i+2})$.</p>
</li>
<li><p>Calculamos las <strong>diferencias</strong> entre el thumbnail de la imagen predicción, $Thumbnail(PI<em>{i+2})$, 
y el thumbnail de la siguiente imagen, $Thumbnail(I</em>{i+2})$, y las ordenamos 
de mayor a menor.<br>El resultado de este proceso nos devuelve la lista de <code>WOIs</code> que debemos
solicitar al servidor, ordenadas de mayor a menor importancia.<br>Tool: <a href="tools.html#tool_differencesthumbnails"><code>differencesthumbnails</code></a>.  </p>
<p><strong>TODO</strong>:  </p>
<ul>
<li><del>No incluir en el listado aquellas <code>WOIs</code> donde no exista diferencia,
para ahorrarnos tener que solicitarlas al servidor.</del></li>
<li><p>Podríamos <em>cambiar el método</em> que utilizamos para calcular las diferencias
entre los dos thumbnails y realizar un estudio utilizando diferentes métricas:</p>
<ul>
<li><strong>Y-SSIM</strong><ul>
<li>Structural Similarity algorithm applied to luma channel only.</li>
</ul>
</li>
<li><strong>RGB-SSIM</strong><ul>
<li>Average of Structural Similarity algorithm applied to R, G, and B channels.</li>
</ul>
</li>
<li><strong>IW-SSIM</strong><ul>
<li>Information Content Weighted Structural Similarity algorithm applied to luma 
channel only.</li>
</ul>
</li>
<li><strong>PSNR-HVS-M</strong><ul>
<li>Peak Signal to Noise Ratio taking into account Contrast Sensitivity Function 
(CSF) and between-coefficient contrast masking of DCT basis functions.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>Solicitamos al servidor los precintos/<strong><code>WOIs</code></strong> (1 precinto = 1 <code>WOI</code>) que nos interesan de la
siguiente imagen, $I_{i+2}$, en función del $bitrate$ estimado.<br>Tool: <a href="tools.html#tool_woistocache"><code>woistocache</code></a>.  </p>
<p><strong>TODO</strong>:  </p>
<ul>
<li>Actualmente el valor del $bitrate$ es un valor constante que se asigna al inicio de
la ejecución del algoritmo. Sería interesante hacer pruebas donde el valor del $bitrate$
pueda ir variando durante la ejecución del algoritmo.</li>
</ul>
</li>
<li><p>Comprimimos la imagen predicción $PI_{i+2}$ (obtenida en el paso 3) con la
utilidad <code>kdu_compress</code>, para convertir de <strong>.pgm</strong> a <strong>.j2c</strong>.<br>Los parámetros de compresión deben coincidir con los parámetros de
compresión iniciales.  </p>
<p><strong>NOTA</strong>:  </p>
<ul>
<li>Esta operación debe realizarse en el cliente y puede ser un poco lenta.</li>
</ul>
</li>
<li><p>Convertimos el archivo <strong>.j2c</strong> de la imagen predicción $PI_{i+2}$ a
<strong>.cache</strong>.<br>Utilizamos la utilidad <a href="tools.html#tool_woistocache"><code>woistocache</code></a> y una lista que contiene todos
los precintos de la imagen. Hay que tener en cuenta que la división
de los precintos para toda la imagen sea exacta. En este caso el
parámetro <code>Precincts Selection Mode = 0</code> para que la selección de
los precintos se realice tal y como lo hace Kakadu.  </p>
<pre><code>woistocache prediction_temp.j2c precincts/xxx.todos.txt WIDTH_RECONS HEIGHT_RECONS ((CLEVELS+1)) CLAYERS 999999999 0
</code></pre></li>
<li><p>Con la utilidad <a href="tools.html#tool_extractcache"><code>extractcache</code></a> extraemos los precinctos de la imagen 
predicción $PI<em>{i+2}$ que no están entre los precintos que hemos solicitado
en el paso 7 para la imagen $I</em>{i+2}$. Los precintos que hemos extraído de la imagen
predicción los guardamos en el archivo $temp_aux.cache$.  </p>
<pre><code>extractcache next_image_j2c_cache prediction_temp.j2c.cache temp_aux.cache
</code></pre></li>
<li><p>Unimos los precintos que tenemos de la siguiente imagen $I<em>{i+2}$ con los precintos
de la imagen predicción $PI</em>{i+2}$ que hemos extraído en el paso anterior y los
ordenamos.</p>
</li>
<li><p>Al solicitar los precintos/<code>WOIs</code> de la siguiente imagen $I_{i+2}$ en función
de un determinado $bitrate$, puede ocurrir que no se reciban los precintos completos
y que solamente se reciban ciertos paquetes. Por este motivo tenemos que revisar
entre todos los precintos que hemos recibido cuáles son los que se encuentran 
incompletos y generar los paquetes vacíos necesarios para completarlos. 
En este punto tendremos un archivo <strong>.cache</strong> que contiene:</p>
<ul>
<li>los precintos que hemos solicitado de la siguiente imagen $I_{i+2}$,</li>
<li>los precintos que hemos extraído de la imagen predicción $PI_{i+2}$ que no
están entre los nuevos precintos que hemos recibido,</li>
<li>los paquetes vacíos que hemos ido generando para completar los precintos
incompletos que hemos recibido de la siguiente imagen $I_{i+2}$.  </li>
</ul>
<p>Tool: <a href="tools.html#tool_cookcache"><code>cookcache</code></a>.  </p>
</li>
<li><p>Descomprimimos el archivo <strong>.cache</strong> con el code-stream.<br>Tool: <a href="tools.html#tool_decodefromcache"><code>decodefromcache</code></a>.  </p>
</li>
</ol>

                    
                    </section>
                
                </div>
            </div>
        </div>

        
        <a href="./index.html" class="navigation navigation-prev"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="./tools.html" class="navigation navigation-next"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        

        <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.1.3/ace.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.1.3/mode-javascript.js"></script>
        <script src="gitbook/jsrepl/jsrepl.js" id="jsrepl-script"></script>
        <script src="gitbook/app.js"></script>
        

    
    <script src="gitbook/plugins/gitbook-plugin-mixpanel/plugin.js"></script>
    

    
    <script src="http://cdn.mathjax.org/mathjax/2.0-latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-mathjax/plugin.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {};
    gitbook.start(config);
});
</script>

    </body>
</html>
