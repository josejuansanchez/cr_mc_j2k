<!DOCTYPE HTML>
<html lang="en-US">
    <head prefix="og: http://ogp.me/ns# book: http://ogp.me/ns/book#">
        
        <meta charset="UTF-8">
        <title>Tools | Conditional Replenishment and Motion Compensation</title>

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="robots" content="index, follow">
        <meta name="author" content="">
        <meta name="description" content="J.J. Sánchez-Hernández, J.P. García-Ortiz, V. González-Ruiz">
        <meta name="keywords" content="gitbook,github" >
        <meta name="generator" content="www.gitbook.io">

        
        <link rel="next" href="./packets.html" />
        
        
        <link rel="prev" href="./algorithm.html" />
        

        <meta property="og:title" content="Tools | Conditional Replenishment and Motion Compensation">
        <meta property="og:site_name" content="Conditional Replenishment and Motion Compensation">
        <meta property="og:type" content="book">
        <meta property="og:locale" content="en_US">

        <meta property="book:author" content="https://github.com/">
        <meta property="book:tag" content="GitBook">

        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">

        <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">
        
    </head>
    <body>
        

        <link rel="stylesheet" href="gitbook/style.css">
        


        
    <div class="book"  data-level="2" data-basepath="." data-revision="1398340400236">
    <div class="book-header">
    <!-- Actions Left -->
    
    <a href="#" class="btn pull-left toggle-summary"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search"><i class="fa fa-search"></i></a>
    <span id="font-settings-wrapper">
        <a href="#" class="btn pull-left toggle-font-settings"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
	<div class="dropdown-caret">
  <span class="caret-outer"></span>
  <span class="caret-inner"></span>
</div>

	<div class="btn-group btn-block">
		<button id="reduce-font-size" class="btn btn-default">A</button>
		<button id="enlarge-font-size" class="btn btn-default">A</button>
	</div>

	<ul class="list-group font-family-list">
		<li class="list-group-item" data-font="0">Serif</li>
		<li class="list-group-item" data-font="1">Sans</li>
	</ul>

	<div class="btn-group btn-group-xs btn-block color-theme-list">
	  <button type="button" class="btn btn-default" id="color-theme-preview-0" data-theme="0">White</button>
	  <button type="button" class="btn btn-default" id="color-theme-preview-1" data-theme="1">Sepia</button>
	  <button type="button" class="btn btn-default" id="color-theme-preview-2" data-theme="2">Night</button>
	</div>
</div>

    </span>

    <!-- Actions Right -->
    <a href="#" target="_blank" class="btn pull-right" data-sharing="google-plus"><i class="fa fa-google-plus"></i></a>
    <a href="#" target="_blank" class="btn pull-right" data-sharing="facebook"><i class="fa fa-facebook"></i></a>
    <a href="#" target="_blank" class="btn pull-right" data-sharing="twitter"><i class="fa fa-twitter"></i></a>

    

    <!-- Title -->
    <h1><a href="./" >Conditional Replenishment and Motion Compensation</a></h1>
</div>

    <div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="Search" class="form-control" />
    </div>
    <ul class="summary">
        
        <li data-level="0" data-path="index.html">
            <a href="./"><i class="fa fa-check"></i> Introduction</a>
        </li>
        
            <li  data-level="1" data-path="algorithm.html">
                
                <a href="./algorithm.html">
                    <i class="fa fa-check"></i> <b>1.</b> Algoritmo
                </a>
                
                
            </li>
        
            <li  data-level="2" data-path="tools.html">
                
                <a href="./tools.html">
                    <i class="fa fa-check"></i> <b>2.</b> Tools
                </a>
                
                
            </li>
        
            <li  data-level="3" data-path="packets.html">
                
                <a href="./packets.html">
                    <i class="fa fa-check"></i> <b>3.</b> JPEG2000 Packet Structure
                </a>
                
                
            </li>
        
            <li  data-level="4" data-path="cacheformat.html">
                
                <a href="./cacheformat.html">
                    <i class="fa fa-check"></i> <b>4.</b> Formato `.cache`
                </a>
                
                
            </li>
        
            <li  data-level="5" data-path="stateoftheart.html">
                
                <a href="./stateoftheart.html">
                    <i class="fa fa-check"></i> <b>5.</b> State of the art
                </a>
                
                
            </li>
        
            <li  data-level="6" data-path="changelog.html">
                
                <a href="./changelog.html">
                    <i class="fa fa-check"></i> <b>6.</b> Changelog
                </a>
                
                
            </li>
        
            <li  data-level="7" data-path="todos.html">
                
                <a href="./todos.html">
                    <i class="fa fa-check"></i> <b>7.</b> TODOs
                </a>
                
                
            </li>
        
            <li  data-level="8" data-path="knapsack.html">
                
                <a href="./knapsack.html">
                    <i class="fa fa-check"></i> <b>8.</b> Knapsack Algorithm
                </a>
                
                
            </li>
        
    </ul>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="page-wrapper" tabindex="-1">
                <div class="book-progress">
    <div class="bar">
        <div class="inner" style="width: 25%;min-width: 12.5%;"></div>
    </div>
    <div class="chapters">
    
        <a href="./index.html" title="Introduction" class="chapter done new-chapter" data-progress="0" style="left: 0%;"></a>
    
        <a href="./algorithm.html" title="Algoritmo" class="chapter done new-chapter" data-progress="1" style="left: 12.5%;"></a>
    
        <a href="./tools.html" title="Tools" class="chapter done new-chapter" data-progress="2" style="left: 25%;"></a>
    
        <a href="./packets.html" title="JPEG2000 Packet Structure" class="chapter  new-chapter" data-progress="3" style="left: 37.5%;"></a>
    
        <a href="./cacheformat.html" title="Formato `.cache`" class="chapter  new-chapter" data-progress="4" style="left: 50%;"></a>
    
        <a href="./stateoftheart.html" title="State of the art" class="chapter  new-chapter" data-progress="5" style="left: 62.5%;"></a>
    
        <a href="./changelog.html" title="Changelog" class="chapter  new-chapter" data-progress="6" style="left: 75%;"></a>
    
        <a href="./todos.html" title="TODOs" class="chapter  new-chapter" data-progress="7" style="left: 87.5%;"></a>
    
        <a href="./knapsack.html" title="Knapsack Algorithm" class="chapter  new-chapter" data-progress="8" style="left: 100%;"></a>
    
    </div>
</div>

                <div class="page-inner">
                
                    <section class="normal" id="section-gitbook_14">
                    
                        <h1 id="tools">Tools</h1>
<ul>
<li><a href="#tool_cookcache"><code>cookcache</code></a></li>
<li><a href="#tool_countsops"><code>countsops</code></a></li>
<li><a href="#tool_decodefromcache"><code>decodefromcache</code></a></li>
<li><a href="#tool_decorrelate"><code>decorrelate</code></a></li>
<li><a href="#tool_differencesthumbnails"><code>differencesthumbnails</code></a></li>
<li><a href="#tool_extractcache"><code>extractcache</code></a></li>
<li><a href="#tool_get_header_size_j2c"><code>get_header_size_j2c</code></a></li>
<li><a href="#tool_motion_estimation"><code>me</code></a></li>
<li><a href="#tool_mogrify"><code>mogrify</code></a></li>
<li><a href="#tool_snr"><code>snr</code></a></li>
<li><a href="#tool_sortcache"><code>sortcache</code></a></li>
<li><a href="#tool_woistocache"><code>woistocache</code></a></li>
</ul>
<h3 id="-a-name-tool_cookcache-a-cookcache"><a name="tool_cookcache"></a>cookcache</h3>
<ul>
<li><p><strong>Descripción</strong>:<br>  Este programa recibe dos archivos con formato <strong><code>.cache</code></strong> y devuelve
  como salida otro archivo con formato <strong><code>.cache</code></strong> formado por los
  paquetes vacíos necesarios para completar los precintos que aparecen en
  el archivo <code>&lt;response.j2c.cache&gt;</code>.</p>
</li>
<li><p><strong>Uso</strong>:  </p>
<pre><code>  cookcache &lt;full.j2c.cache&gt; &lt;response.j2c.cache&gt;
</code></pre><ul>
<li><p><strong>Entrada:</strong></p>
<ul>
<li><p><code>&lt;full.j2c.cache&gt;</code>: Este archivo contiene todo el codestream
completo de una imagen.</p>
</li>
<li><p><code>&lt;response.j2c.cache&gt;</code>: Este archivo contiene la respuesta que nos
envía el servidor, para una petición formada por una serie de WOIs
(precintos) y un determinado bitrate. Lo normal es que esta
respuesta contega solamente algunos de los paquetes que forman un
precinto, por este motivo habrá que localizar cuáles son los
paquetes que faltan para completar el precinto completo y crear
paquetes vacíos en su lugar.</p>
</li>
</ul>
</li>
<li><p><strong>Salida:</strong></p>
<p>  Este programa devuelve el archivo <code>emptypackets.j2c.cache</code> con todos los
  paquetes vacíos que son necesarios para completar todos los precinctos.</p>
<p>  La fusión de los archivos <code>&lt;response.j2c.cache&gt;</code> +
  <code>emptypackets.j2c.cache</code> contendrá el codestream necesario para poder
  realizar la fusión de dos imágenes en el dominio JPEG2000.</p>
</li>
</ul>
</li>
</ul>
<h3 id="-a-name-tool_countsops-a-countsops"><a name="tool_countsops"></a>countsops</h3>
<ul>
<li><p><strong>Descripción</strong>:<br>  Esta utilidad devuelve el número de paquetes que contiene un archivo <strong><code>.j2c</code></strong>.</p>
</li>
<li><p><strong>Uso</strong>:  </p>
<pre><code>  countsops &lt;archivo.j2c&gt;
</code></pre></li>
</ul>
<h3 id="-a-name-tool_decodefromcache-a-decodefromcache"><a name="tool_decodefromcache"></a>decodefromcache</h3>
<ul>
<li><p><strong>Descripción</strong>:<br>  Esta utilidad permite descomprimir un archivo con code-stream en formato <strong><code>.cache</code></strong>.
  Como salida puede devolver archivos con formato <strong><code>.pgm</code></strong> o <strong><code>.ppm</code></strong>.</p>
</li>
<li><p><strong>Uso</strong>:  </p>
<pre><code>  decodefromcache &lt;Caché&gt; &lt;Imagen OUT&gt; &lt;Ancho Img. Reconst&gt; &lt;Alto Img. Reconst&gt;
</code></pre></li>
</ul>
<h3 id="-a-name-tool_decorrelate-a-decorrelate"><a name="tool_decorrelate"></a>decorrelate</h3>
<ul>
<li><p><strong>Descripción</strong>:<br>Genera una imagen predicción a partir de unos vectores de movimiento de entrada.</p>
</li>
<li><p><strong>Uso</strong>:  </p>
<pre><code>  MCJ2K/bin/decorrelate -p 2 -x X -y Y -b B -s S -e odd_image -o odd_image -i motion -v V
</code></pre><ul>
<li><code>V</code>: Overlapping. Para difuminar los bordes de los bloques.</li>
</ul>
</li>
</ul>
<h3 id="-a-name-tool_differencesthumbnails-a-differencesthumbnails"><a name="tool_differencesthumbnails"></a>differencesthumbnails</h3>
<ul>
<li><p><strong>Descripción</strong>:<br>Calcula las diferencias entre dos thumbnails.</p>
</li>
<li><p><strong>Uso</strong>:  </p>
<pre><code>  differencesthumbnails &lt;in_filenameA&gt; &lt;in_filenameB&gt; &lt;out_filename_precincts_list.dat&gt; &lt;out_filename_precincts_list.txt&gt; &lt;w_precint_size&gt; &lt;h_precint_size&gt; &lt;w_offset&gt; &lt;h_offset&gt;
</code></pre><ul>
<li><p><code>out_filename_precincts_list.dat</code>: Archivo de salida (formato binario) con la lista de coordenadas de precintos que han cambiado.</p>
</li>
<li><p><code>out_filename_precincts_list.txt</code>: Archivo de salida (formato texto) con la lista de coordenadas de precintos que han cambiado.    </p>
</li>
<li><p><code>w_precint_size</code>: Ancho del precinto del thumbnail. </p>
</li>
<li><p><code>h_precint_size</code>: Alto del precinto del thumbnail.</p>
</li>
<li><p><code>w_offset</code>: Factor de escala que le hay que aplicarle a la coordenada X de los precintos para que se correpondan con las coordenadas de otros precintos de otra resolución.</p>
</li>
<li><p><code>h_offset</code>: Factor de escala que le hay que aplicarle a la coordenada Y de los precintos para que se correpondan con las coordenadas de otros precintos de otra resolución.</p>
</li>
</ul>
</li>
</ul>
<h3 id="-a-name-tool_extractcache-a-extractcache"><a name="tool_extractcache"></a>extractcache</h3>
<ul>
<li><p><strong>Descripción</strong>:<br>  Esta utilidad nos permite extraer los precintos de una imagen predicción <strong>$PI$</strong> que no
  están entre los precintos de otra imagen <strong>$I$</strong>. Como salida devuelve un archivo con
  formato <strong><code>.cache</code></strong>, con todos los precintos que no están en <strong>$I$</strong>.<br>  Estamos calculando el complemento del conjunto de precintos <strong>$I$</strong>.    </p>
<p>  $I^{&#39;} = { x \in PI | x \notin I }$</p>
<p>  <img src="images/complemento.png" alt=""></p>
</li>
<li><p><strong>Uso</strong>:  </p>
<pre><code>  extractcache &lt;archivo.cache WOIs&gt; &lt;archivo.cache BACKGROUND&gt; &lt;archivo.cache OUT&gt;
</code></pre></li>
</ul>
<h3 id="-a-name-tool_get_header_size_j2c-a-get_header_size_j2c"><a name="tool_get_header_size_j2c"></a>get_header_size_j2c</h3>
<ul>
<li><p><strong>Descripción</strong>:<br>  Esta utilidad nos permite conocer el número de bytes de la cabecera de un archivo <strong><code>.j2c</code></strong>.</p>
</li>
<li><p><strong>Uso</strong>:  </p>
<pre><code>  get_header_size_j2c &lt;archivo.j2c&gt;
</code></pre></li>
</ul>
<h3 id="-a-name-tool_motion_estimation-a-me"><a name="tool_motion_estimation"></a>me</h3>
<ul>
<li><p><strong>Descripción</strong>:<br>Calcula los vectores de movimiento entre dos imágenes.</p>
</li>
<li><p><strong>Uso</strong>: </p>
<pre><code>  MCJ2K/bin/me -p 2 -x X -y Y -b B -s S -e even_image -o odd_image -a A -d D
</code></pre><ul>
<li><p><code>X</code>: Ancho de la imagen.</p>
</li>
<li><p><code>Y</code>: Alto de la imagen.</p>
</li>
<li><p><code>B</code>: Tamaño de bloque $B \times B$.</p>
</li>
<li><p><code>S</code>: Tamaño del área de búsqueda.</p>
</li>
<li><p><code>even_image</code>: Imagen par, $I_i$.</p>
</li>
<li><p><code>odd_image</code>: Imagen impar, $I_{i+1}$.</p>
</li>
<li><p><code>A</code>: Precisión subpixel.</p>
</li>
<li><p><code>D</code>: Tamaño del borde de los bloques.</p>
</li>
</ul>
</li>
</ul>
<h3 id="-a-name-tool_mogrify-a-mogrify"><a name="tool_mogrify"></a>mogrify</h3>
<ul>
<li><p><strong>Descripción</strong>:<br>Es una utilidad de <a href="http://www.imagemagick.org" target="_blank">ImageMagick</a> que nos permite modificar
el tamaño de una imagen. Puede econtrar más información sobre esta utilidad en la 
<a href="http://www.imagemagick.org/script/mogrify.php" target="_blank">web oficial</a>.</p>
</li>
<li><p><strong>Uso</strong>:  </p>
<pre><code>  mogrify -resize 160x96 prediction_thumb.pgm
</code></pre></li>
</ul>
<h3 id="-a-name-tool_snr-a-snr"><a name="tool_snr"></a>snr</h3>
<ul>
<li><p><strong>Descripción</strong>:<br>  Esta utilidad permite calcular el PSNR entre dos imágenes.</p>
</li>
<li><p><strong>Uso</strong>:  </p>
<pre><code>  snr --type=uchar --peak=255 --file_A=&lt;imageA&gt; --file_B=&lt;imageB&gt;
</code></pre></li>
</ul>
<h3 id="-a-name-tool_sortcache-a-sortcache"><a name="tool_sortcache"></a>sortcache</h3>
<ul>
<li><p><strong>Descripción</strong>:<br>  Esta utilidad nos permite ordenar los paquetes del code-stream siguiendo una progresión <strong>LRCP</strong>.
  Como entrada recibe un archivo con formato <strong><code>.cache</code></strong> desordenado y como salida devuelve otro
  archivo con formato <strong><code>.cache</code></strong> pero ya ordenado.</p>
</li>
<li><p><strong>Uso</strong>:  </p>
<pre><code>  sortcache &lt;filename.cache&gt;
</code></pre></li>
</ul>
<h3 id="-a-name-tool_woistocache-a-woistocache"><a name="tool_woistocache"></a>woistocache</h3>
<ul>
<li><p><strong>Descripción</strong>:<br>  Esta utilidad simula una serie de peticiones al servidor para obtener los precintos que nos interesan de una imagen.
  Permite obtener los precintos de una imagen en función del <em>bitrate</em> especificado como parámetro de entrada.    </p>
<p>  Hemos modificado la utilidad <code>woistocache</code> para que sólo nos
  devuelva los precintos que coinciden con la WOI solicitada, ya que
  el código que estábamos utilizando basado en las librerías de Kakadu
  también seleccionaba algunos precintos que estaban junto a los
  bordes de la WOI solicitada.\
  La utilidad <code>woistocache</code> ahora tiene un nuevo parámetro de entrada
  que nos permite seleccionar el modo de selección de los precintos.</p>
<ul>
<li><p><code>Precincts Selection Mode = 0</code>. Los precintos se seleccionan tal
y como lo hace Kakadu.</p>
</li>
<li><p><code>Precincts Selection Mode = 1</code>. Los precintos se seleccionan
sólo cuando coinciden con la WOI. (Este es el modo utilizado
actualmente en nuestros experimentos).</p>
<p>La utilidad <code>woistocache</code>, genera 4 archivos de salida:</p>
</li>
<li><p><strong><code>.j2c.cache</code></strong><br>Devuelve un archivo con el code-stream JPEG2000 de los precintos
solicitados.</p>
</li>
<li><p><strong><code>.j2c.lrcp</code></strong><br>Devuelve una lista donde se indica las coordenadas LRCP y el
tamaño en bytes para cada uno de los precintos de la lista de
entrada.</p>
</li>
<li><p><strong><code>.j2c.lrcp.sort</code></strong><br>Devuelve una lista <strong>ordenada</strong> donde se indica las coordenadas
LRCP y el tamaño en bytes para cada uno de los precintos de la
lista de entrada.\
El orden de la lista puede ser de dos tipos:</p>
<ul>
<li><p><code>Type 1</code>: Vamos cogiendo el primer paquete de cada precinto.</p>
</li>
<li><p><code>Type 2</code>: Vamos cogiendo todos los paquetes de una capa de
calidad de cada precinto.</p>
</li>
</ul>
</li>
<li><p><strong><code>.j2c.woi</code></strong><br>Devuelve una lista donde se indican los precintos que se han
podido transmitir teniendo en cuenta el valor del <em>bitrate</em>
establecido.</p>
</li>
</ul>
</li>
<li><p><strong>Uso</strong>:  </p>
<pre><code>  woistocache &lt;Imagen J2C&gt; &lt;Lista de WOIs .txt&gt; &lt;W Precinct size&gt; &lt;H Precinct size&gt; &lt;r&gt; &lt;l&gt; &lt;BitRate (Bytes)&gt; &lt;Precincts Selection Mode&gt;
</code></pre><ul>
<li><code>Imagen J2C</code> </li>
<li><code>Lista de WOIs .txt</code> </li>
<li><code>W Precinct size</code></li>
<li><code>H Precinct size</code></li>
<li><code>r</code></li>
<li><code>l</code> </li>
<li><code>BitRate (Bytes)</code></li>
<li><code>Precincts Selection Mode</code></li>
</ul>
</li>
</ul>
<p><strong>NOTA - 29/01/2014</strong>:<br>La funcionalidad del modo <em>Precincts Selection Mode = $1$</em>
está deshabilitada temporalmente porque no funciona como se espera
cuando las imágenes no tienen el mismo número de precintos en todos
los niveles de resolución. Por ejemplo:</p>
<pre><code>CLEVELS=3
CPRECINCTS=&quot;{128,128},{64,64},{32,32},{32,32}&quot;
</code></pre><p>En este caso tenemos:</p>
<ul>
<li>Resolution level <em>3</em>: 1280x768. 60 precintos de 128x128.</li>
<li>Resolution level <em>2</em>: 640x384. 60 precintos de 64x64.</li>
<li>Resolution level <em>1</em>: 320x192. 60 precintos de 32x32.</li>
<li>Resolution level <em>0</em>: 160x96. 15 precintos de 32x32.</li>
</ul>

                    
                    </section>
                
                </div>
            </div>
        </div>

        
        <a href="./algorithm.html" class="navigation navigation-prev"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="./packets.html" class="navigation navigation-next"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        

        <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.1.3/ace.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.1.3/mode-javascript.js"></script>
        <script src="gitbook/jsrepl/jsrepl.js" id="jsrepl-script"></script>
        <script src="gitbook/app.js"></script>
        

    
    <script src="gitbook/plugins/gitbook-plugin-mixpanel/plugin.js"></script>
    

    
    <script src="http://cdn.mathjax.org/mathjax/2.0-latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-mathjax/plugin.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {};
    gitbook.start(config);
});
</script>

    </body>
</html>
