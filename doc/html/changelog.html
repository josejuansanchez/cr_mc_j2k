<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title></title>
  <style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; }
code > span.dt { color: #902000; }
code > span.dv { color: #40a070; }
code > span.bn { color: #40a070; }
code > span.fl { color: #40a070; }
code > span.ch { color: #4070a0; }
code > span.st { color: #4070a0; }
code > span.co { color: #60a0b0; font-style: italic; }
code > span.ot { color: #007020; }
code > span.al { color: #ff0000; font-weight: bold; }
code > span.fu { color: #06287e; }
code > span.er { color: #ff0000; font-weight: bold; }
  </style>
  <link rel="stylesheet" href="css/style.css" type="text/css" />
</head>
<body>
<h1 id="changelog">Changelog</h1>
<h3 id="section">03/02/2014</h3>
<p>Modificaciones sobre el método:</p>
<pre><code>bool jp2_area::woi_to_lrcp_modified(char filename_woi[], int w, int h, int r, int q)</code></pre>
<p>Con este código podemos extraer información importante a partir del code-stream:</p>
<ul>
<li>Dimensiones de la imagen.</li>
<li>Número de niveles de resolución de la imagen.</li>
<li>Dimensiones de cada nivel de resolución.</li>
<li>Dimensiones de los precintos que forman cada nivel de resolución.</li>
<li>Número de precintos que existen en cada nivel de resolución.</li>
</ul>
<table class="sourceCode cpp numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
</pre></td><td class="sourceCode"><pre><code class="sourceCode cpp">  <span class="co">// Obtenemos el número de precintos que hay en cada nivel de resolución  </span>
  kdu_dims idims;
  codestream.apply_input_restrictions(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, NULL);
  codestream.get_dims(<span class="dv">0</span>, idims);
  printf(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">Image dimension: %d - %d</span><span class="ch">\n</span><span class="st">&quot;</span>, idims.size.x, idims.size.y);

  kdu_dims roi, realroi;
  roi.pos = kdu_coords(<span class="dv">0</span>, <span class="dv">0</span>);
  roi.size = kdu_coords(idims.size.x, idims.size.y);

  codestream.apply_input_restrictions(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, NULL);
  codestream.map_region(<span class="dv">0</span>, roi, realroi);
  codestream.apply_input_restrictions(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, &amp;realroi);

  <span class="dt">int</span> numr = codestream.get_min_dwt_levels() + <span class="dv">1</span>;
  kdu_tile tile = codestream.open_tile(kdu_coords(<span class="dv">0</span>, <span class="dv">0</span>));
  kdu_tile_comp comp = tile.access_component(<span class="dv">0</span>);

  kdu_dims *precincts_in_each_resolution = <span class="kw">new</span> kdu_dims[numr];
  kdu_dims *resolution_size = <span class="kw">new</span> kdu_dims[numr];  
  kdu_dims *precincts_size_in_each_resolution = <span class="kw">new</span> kdu_dims[numr];

  <span class="kw">for</span> (<span class="dt">int</span> resolution = <span class="dv">0</span>; resolution &lt; numr; resolution++) {
    printf(<span class="st">&quot;Resolution: %d</span><span class="ch">\n</span><span class="st">&quot;</span>, resolution);

    kdu_resolution res = comp.access_resolution(resolution);

    kdu_dims rdims;
    res.get_dims(rdims);
    printf(<span class="st">&quot;</span><span class="ch">\t</span><span class="st">Dimension.</span><span class="ch">\t</span><span class="st"> x: %5d </span><span class="ch">\t</span><span class="st"> y: %5d</span><span class="ch">\n</span><span class="st">&quot;</span>, rdims.size.x, rdims.size.y);
    resolution_size[resolution] = rdims;

    kdu_dims pdims;
    res.get_valid_precincts(pdims);
    printf(<span class="st">&quot;</span><span class="ch">\t</span><span class="st"># of precincts.</span><span class="ch">\t</span><span class="st"> x: %5d </span><span class="ch">\t</span><span class="st"> y: %5d</span><span class="ch">\n</span><span class="st">&quot;</span>, pdims.size.x, pdims.size.y);
    precincts_in_each_resolution[resolution] = pdims;

    precincts_size_in_each_resolution[resolution].size.x = rdims.size.x / pdims.size.x;
    precincts_size_in_each_resolution[resolution].size.y = rdims.size.y / pdims.size.y;
    printf(<span class="st">&quot;</span><span class="ch">\t</span><span class="st">Precincts size.</span><span class="ch">\t</span><span class="st"> x: %5d </span><span class="ch">\t</span><span class="st"> y: %5d</span><span class="ch">\n</span><span class="st">&quot;</span>, precincts_size_in_each_resolution[resolution].size.x, precincts_size_in_each_resolution[resolution].size.x);
  }
  tile.close();  </code></pre></td></tr></table>
<p>También hemos modificado la forma de detectar si un precinto coincide exactamente con la región de la WOI. Para poder eliminar los precintos de los bordes que Kakadu puede añadir.</p>
<table class="sourceCode cpp numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="sourceCode"><pre><code class="sourceCode cpp">...
<span class="kw">for</span> (<span class="dt">int</span> resolution = <span class="dv">0</span>; resolution &lt; r; resolution++) {
   ...

   <span class="dt">float</span> scale_factor = pow(<span class="dv">2</span>,r - <span class="dv">1</span> - resolution);

   <span class="kw">if</span> (((<span class="dt">int</span>)((ww.x / scale_factor) / precincts_size_in_each_resolution[resolution].size.x) == px) &amp;&amp;
       ((<span class="dt">int</span>)((ww.y / scale_factor) / precincts_size_in_each_resolution[resolution].size.y) == py)) {
      fprintf(fc,<span class="st">&quot;%d %d %d %d: %d %d %d %d %d: %ld</span><span class="ch">\n</span><span class="st">&quot;</span>, ww.x, ww.y, ww.w, ww.h, l, resolution, c, py, px, (<span class="dt">long</span>)pid);
   }
   ...
}
...</code></pre></td></tr></table>
</body>
</html>
